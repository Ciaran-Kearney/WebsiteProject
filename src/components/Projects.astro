---
// Projects component with modal popups
---

<section id="projects" class="projects-section">
  <div class="container">
    <h2 class="section-title">Projects</h2>
    <p class="section-subtitle">Professional Projects</p>
    <div class="projects-grid">
      <div class="project-card" data-project="grange">
        <div class="project-header">
          <div class="project-icon">üè≠</div>
          <h3>Grange Backup Power Plant</h3>
        </div>
        <p class="project-description">Environmental noise planning application and assessment for a 96MW backup power plant project.</p>
        <div class="project-tags">
          <span class="tag">Environmental Noise</span>
          <span class="tag">Power Generation</span>
          <span class="tag">96MW Facility</span>
        </div>
        <button class="view-project-btn">View Project</button>
      </div>

      <div class="project-card" data-project="bt">
        <div class="project-header">
          <div class="project-icon">üñ•Ô∏è</div>
          <h3>BT Ireland Data Centre</h3>
        </div>
        <p class="project-description">Environmental noise planning assessment for BT Ireland Data Centre in Blanchardstown.</p>
        <div class="project-tags">
          <span class="tag">Data Centre</span>
          <span class="tag">Environmental Assessment</span>
          <span class="tag">Planning</span>
        </div>
        <button class="view-project-btn">View Project</button>
      </div>

      <div class="project-card" data-project="friarstown">
        <div class="project-header">
          <div class="project-icon">‚òÄÔ∏è</div>
          <h3>Friarstown Solar Farm</h3>
        </div>
        <p class="project-description">Environmental noise assessment for a 50MW solar farm development project.</p>
        <div class="project-tags">
          <span class="tag">Renewable Energy</span>
          <span class="tag">50MW Facility</span>
          <span class="tag">Environmental</span>
        </div>
        <button class="view-project-btn">View Project</button>
      </div>

      <div class="project-card" data-project="merck">
        <div class="project-header">
          <div class="project-icon">üèóÔ∏è</div>
          <h3>Merck 2.0 Manufacturing</h3>
        </div>
        <p class="project-description">Comprehensive noise assessment for a ‚Ç¨150 million expansion of the Merck manufacturing facility.</p>
        <div class="project-tags">
          <span class="tag">Manufacturing</span>
          <span class="tag">Large Scale</span>
          <span class="tag">Industrial</span>
        </div>
        <button class="view-project-btn">View Project</button>
      </div>

      <div class="project-card" data-project="dargle">
        <div class="project-header">
          <div class="project-icon">üè´</div>
          <h3>Project Dargle Schools</h3>
        </div>
        <p class="project-description">Environmental noise assessment for the Project Dargle Schools Bundle development.</p>
        <div class="project-tags">
          <span class="tag">Education</span>
          <span class="tag">Construction</span>
          <span class="tag">Planning</span>
        </div>
        <button class="view-project-btn">View Project</button>
      </div>

      <div class="project-card" data-project="irishlife">
        <div class="project-header">
          <div class="project-icon">üè¢</div>
          <h3>Irish Life Block 3</h3>
        </div>
        <p class="project-description">Room acoustics design for major redevelopment of Irish Life offices on Abbey Street.</p>
        <div class="project-tags">
          <span class="tag">Room Acoustics</span>
          <span class="tag">Office Design</span>
          <span class="tag">Renovation</span>
        </div>
        <button class="view-project-btn">View Project</button>
      </div>
    </div>
  </div>
</section>

<!-- Modal Template -->
<div class="project-modal" id="projectModal">
  <div class="modal-overlay"></div>
  <div class="modal-dots-background"></div>
  <div class="modal-container">
    <button class="modal-close" aria-label="Close modal">√ó</button>
    <div class="modal-content">
      <div class="modal-media">
        <div class="media-placeholder"></div>
      </div>
      <div class="modal-info">
        <h2 class="modal-title"></h2>
        <div class="modal-tags"></div>
        <div class="modal-description"></div>
        <div class="modal-details"></div>
      </div>
    </div>
  </div>
</div>

<style>
  .projects-section {
    padding: 4rem 0;
  }

  .projects-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
  }

  .project-card {
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    padding: 1.5rem;
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .project-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 20px rgba(0, 180, 216, 0.15);
  }

  .project-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .project-icon {
    font-size: 1.5rem;
    background: rgba(0, 180, 216, 0.1);
    padding: 0.5rem;
    border-radius: 8px;
  }

  .view-project-btn {
    margin-top: 1rem;
    background: rgba(0, 180, 216, 0.1);
    color: #00b4d8;
    border: 1px solid #00b4d8;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 100%;
  }

  .view-project-btn:hover {
    background: #00b4d8;
    color: #0A1929;
  }

  /* Modal Styles */
  .project-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1000;
  }

  .project-modal.active {
    display: block;
  }

  .modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(10, 25, 41, 0.85);
    backdrop-filter: blur(5px);
    z-index: 1001;
  }

  .modal-dots-background {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1002;
    pointer-events: none;
    overflow: hidden;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .modal-container {
    position: relative;
    width: 90%;
    max-width: 1200px;
    max-height: 90vh;
    margin: 2rem auto;
    background: rgba(10, 25, 41, 0.95);
    border-radius: 12px;
    border: 1px solid rgba(0, 180, 216, 0.2);
    overflow: hidden;
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.3s ease;
    z-index: 1003;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  }

  .project-modal.active .modal-container {
    opacity: 1;
    transform: translateY(0);
  }

  .modal-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    color: #00b4d8;
    font-size: 2rem;
    cursor: pointer;
    z-index: 1004;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.3s ease;
  }

  .modal-close:hover {
    background: rgba(0, 180, 216, 0.1);
  }

  .modal-content {
    max-height: 90vh;
    overflow-y: auto;
    padding: 2rem;
  }

  .modal-media {
    width: 100%;
    margin-bottom: 2rem;
    border-radius: 8px;
    overflow: hidden;
  }

  .media-placeholder {
    width: 100%;
    padding-top: 56.25%; /* 16:9 aspect ratio */
    background: rgba(0, 180, 216, 0.1);
    position: relative;
  }

  .modal-title {
    color: #00b4d8;
    margin-bottom: 1rem;
  }

  .modal-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
  }

  .modal-description {
    color: #94a3b8;
    line-height: 1.6;
    margin-bottom: 2rem;
  }

  .modal-details {
    color: #94a3b8;
  }

  .modal-dot {
    position: absolute;
    border-radius: 50%;
    pointer-events: none;
    box-shadow: 0 0 4px rgba(0, 180, 216, 0.3);
    transition: opacity 0.3s ease;
  }

  @media (min-width: 768px) {
    .modal-content {
      display: grid;
      grid-template-columns: 1.5fr 1fr;
      gap: 2rem;
      align-items: start;
    }

    .modal-media {
      margin-bottom: 0;
      position: sticky;
      top: 2rem;
    }
  }
</style>

<script>
  const projectData = {
    grange: {
      title: "Grange Backup Power Plant",
      description: "Environmental noise planning application and assessment for a 96MW backup power plant project.",
      details: `
        <h3>Project Overview</h3>
        <p>The Grange Backup Power Plant project involved comprehensive environmental noise assessment for a new 96MW facility. Key challenges included:</p>
        <ul>
          <li>Detailed noise modeling of multiple generator units</li>
          <li>Assessment of cumulative impact with existing infrastructure</li>
          <li>Development of noise mitigation strategies</li>
          <li>Stakeholder consultation and planning compliance</li>
        </ul>
        <p>The project successfully achieved planning approval with innovative noise control solutions that balanced operational requirements with environmental protection.</p>
      `,
      tags: ["Environmental Noise", "Power Generation", "96MW Facility"]
    },
    bt: {
      title: "BT Ireland Data Centre",
      description: "Environmental noise planning assessment for BT Ireland Data Centre in Blanchardstown.",
      details: `
        <h3>Project Overview</h3>
        <p>The BT Ireland Data Centre project presented unique challenges in urban noise control:</p>
        <ul>
          <li>24/7 operational requirements in an urban setting</li>
          <li>Complex HVAC and cooling system noise management</li>
          <li>Integration with existing infrastructure</li>
          <li>Detailed predictive noise modeling</li>
        </ul>
        <p>Our solutions enabled continuous operation while maintaining compliance with strict urban noise limits.</p>
      `,
      tags: ["Data Centre", "Environmental Assessment", "Planning"]
    },
    friarstown: {
      title: "Friarstown Solar Farm",
      description: "Environmental noise assessment for a 50MW solar farm development project.",
      details: `
        <h3>Project Overview</h3>
        <p>The Friarstown Solar Farm project focused on environmental noise considerations for a large-scale renewable energy facility:</p>
        <ul>
          <li>Assessment of inverter and transformer noise emissions</li>
          <li>Evaluation of construction phase impacts</li>
          <li>Development of noise control measures</li>
          <li>Environmental Impact Assessment Report preparation</li>
        </ul>
        <p>The project successfully obtained planning permission, contributing to Ireland's renewable energy infrastructure.</p>
      `,
      tags: ["Renewable Energy", "50MW Facility", "Environmental"]
    },
    merck: {
      title: "Merck 2.0 Manufacturing",
      description: "Comprehensive noise assessment for a ‚Ç¨150 million expansion of the Merck manufacturing facility.",
      details: `
        <h3>Project Overview</h3>
        <p>The Merck 2.0 Manufacturing expansion project required detailed acoustic analysis and planning:</p>
        <ul>
          <li>Complex industrial noise source assessment</li>
          <li>Phased construction noise management</li>
          <li>Integration with existing facility operations</li>
          <li>Development of noise control specifications</li>
        </ul>
        <p>Our acoustic design enabled the facility expansion while maintaining environmental compliance and operational efficiency.</p>
      `,
      tags: ["Manufacturing", "Large Scale", "Industrial"]
    },
    dargle: {
      title: "Project Dargle Schools",
      description: "Environmental noise assessment for the Project Dargle Schools Bundle development.",
      details: `
        <h3>Project Overview</h3>
        <p>The Project Dargle Schools Bundle involved acoustic considerations for educational facilities:</p>
        <ul>
          <li>Traffic noise impact assessment</li>
          <li>Construction phase noise management</li>
          <li>Building envelope sound insulation design</li>
          <li>External play area acoustic planning</li>
        </ul>
        <p>The project delivered optimal acoustic environments for learning while managing environmental noise impacts.</p>
      `,
      tags: ["Education", "Construction", "Planning"]
    },
    irishlife: {
      title: "Irish Life Block 3",
      description: "Room acoustics design for major redevelopment of Irish Life offices on Abbey Street.",
      details: `
        <h3>Project Overview</h3>
        <p>The Irish Life Block 3 project focused on creating optimal acoustic environments for modern office spaces:</p>
        <ul>
          <li>Open plan office acoustic design</li>
          <li>Meeting room sound insulation</li>
          <li>Reverberation control in communal areas</li>
          <li>Integration with mechanical services noise control</li>
        </ul>
        <p>The project successfully delivered comfortable and productive workspace environments with excellent acoustic quality.</p>
      `,
      tags: ["Room Acoustics", "Office Design", "Renovation"]
    }
  };

  class Dot {
    constructor(container) {
      this.container = container;
      this.resetPosition();
      this.size = Math.random() * 2 + 2; // 2-4px size range
      this.baseSize = this.size;
      this.opacity = 0;
      this.fadeSpeed = Math.random() * 0.004 + 0.002;
      this.fadeDirection = 'in';
      this.maxOpacity = Math.random() * 0.4 + 0.3; // Much higher opacity range 0.3-0.7
      this.velocity = {
        x: (Math.random() - 0.5) * 1,
        y: (Math.random() - 0.5) * 1
      };
      this.pulseSpeed = Math.random() * 0.02 + 0.01;
      this.pulsePhase = Math.random() * Math.PI * 2;

      this.element = document.createElement('div');
      this.element.className = 'modal-dot';
      this.element.style.position = 'absolute';
      this.element.style.width = `${this.size}px`;
      this.element.style.height = `${this.size}px`;
      this.element.style.borderRadius = '50%';
      this.updatePosition();

      const colorChoice = Math.random();
      if (colorChoice > 0.7) {
        // Bright electric blue
        this.element.style.background = `rgba(0, 180, 255, 1.0)`;
        this.element.style.boxShadow = `0 0 8px rgba(0, 180, 255, 0.8), 0 0 12px rgba(0, 180, 255, 0.5)`;
      } else if (colorChoice > 0.4) {
        // Bright cyan
        this.element.style.background = `rgba(0, 255, 255, 1.0)`;
        this.element.style.boxShadow = `0 0 8px rgba(0, 255, 255, 0.8), 0 0 12px rgba(0, 255, 255, 0.5)`;
      } else {
        // Bright white with blue tint
        this.element.style.background = 'rgba(220, 240, 255, 1.0)';
        this.element.style.boxShadow = `0 0 8px rgba(220, 240, 255, 0.8), 0 0 12px rgba(220, 240, 255, 0.5)`;
      }

      this.element.style.opacity = '0';
      container.appendChild(this.element);
    }

    resetPosition() {
      const rect = this.container?.getBoundingClientRect() || { width: window.innerWidth, height: window.innerHeight };
      this.x = Math.random() * rect.width;
      this.y = Math.random() * rect.height;
    }

    updatePosition() {
      // Add movement
      this.x += this.velocity.x;
      this.y += this.velocity.y;

      // Wrap around screen
      const rect = this.container?.getBoundingClientRect() || { width: window.innerWidth, height: window.innerHeight };
      if (this.x < 0) this.x = rect.width;
      if (this.x > rect.width) this.x = 0;
      if (this.y < 0) this.y = rect.height;
      if (this.y > rect.height) this.y = 0;

      // Add pulsing effect
      const pulse = Math.sin(this.pulsePhase) * 0.3 + 1;
      const currentSize = this.baseSize * pulse;
      
      this.element.style.transform = `translate3d(${this.x}px, ${this.y}px, 0) scale(${pulse})`;
      this.pulsePhase += this.pulseSpeed;
    }

    update() {
      if (this.fadeDirection === 'in') {
        this.opacity += this.fadeSpeed;
        if (this.opacity >= this.maxOpacity) {
          this.opacity = this.maxOpacity;
          this.fadeDirection = 'out';
        }
      } else {
        this.opacity -= this.fadeSpeed;
        if (this.opacity <= 0) {
          this.opacity = 0;
          this.fadeDirection = 'in';
          this.resetPosition();
        }
      }
      this.updatePosition();
      this.element.style.opacity = this.opacity.toString();
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('projectModal');
    const viewButtons = document.querySelectorAll('.view-project-btn');
    const closeButton = modal.querySelector('.modal-close');
    const overlay = modal.querySelector('.modal-overlay');
    const dotsContainer = modal.querySelector('.modal-dots-background');
    let dots = [];
    let animationFrame = null;

    function initModalDots() {
      // Clear any existing dots
      if (dotsContainer) {
        dotsContainer.innerHTML = '';
        dots = [];
        const numDots = Math.floor(Math.min((window.innerWidth * window.innerHeight) / 10000, 120)); // Even more dots

        // Wait for container to be visible
        requestAnimationFrame(() => {
          for (let i = 0; i < numDots; i++) {
            dots.push(new Dot(dotsContainer));
          }
          // Start animation after dots are created
          if (!animationFrame) {
            animationFrame = requestAnimationFrame(animateDots);
          }
        });
      }
    }

    function animateDots() {
      if (dots.length > 0 && modal.classList.contains('active')) {
        dots.forEach(dot => dot.update());
        animationFrame = requestAnimationFrame(animateDots);
      }
    }

    function openModal(projectId) {
      const data = projectData[projectId];
      if (!data) return;

      // Populate modal content
      modal.querySelector('.modal-title').textContent = data.title;
      modal.querySelector('.modal-description').textContent = data.description;
      modal.querySelector('.modal-details').innerHTML = data.details;
      
      // Populate tags
      const tagsContainer = modal.querySelector('.modal-tags');
      tagsContainer.innerHTML = data.tags.map(tag => `<span class="tag">${tag}</span>`).join('');

      // Show modal
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';

      // Initialize dots after modal is visible
      setTimeout(() => {
        dotsContainer.style.opacity = '1';
        initModalDots();
      }, 100);
    }

    function closeModal() {
      modal.classList.remove('active');
      document.body.style.overflow = '';
      
      // Stop animation and clear dots
      if (animationFrame) {
        cancelAnimationFrame(animationFrame);
        animationFrame = null;
      }
      if (dotsContainer) {
        dotsContainer.style.opacity = '0';
        setTimeout(() => {
          dotsContainer.innerHTML = '';
          dots = [];
        }, 300);
      }
    }

    viewButtons.forEach(button => {
      button.addEventListener('click', (e) => {
        const projectId = e.target.closest('.project-card').dataset.project;
        openModal(projectId);
      });
    });

    closeButton.addEventListener('click', closeModal);
    overlay.addEventListener('click', closeModal);

    // Close on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal.classList.contains('active')) {
        closeModal();
      }
    });

    // Handle window resize
    let resizeTimeout;
    window.addEventListener('resize', () => {
      if (modal.classList.contains('active')) {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
          // Reinitialize dots on resize
          if (animationFrame) {
            cancelAnimationFrame(animationFrame);
            animationFrame = null;
          }
          initModalDots();
        }, 250);
      }
    });
  });
</script>
